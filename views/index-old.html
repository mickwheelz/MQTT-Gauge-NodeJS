<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>MQTT Dash</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <script src="js/mqttws31.js" type="text/javascript"></script>
        <!-- <link href="css/styles.css" rel="stylesheet" /> -->
        <script src="js/jquery-1.10.2.min.js"></script>
        <script src="js/knockout-3.0.0.js"></script>
        <script src="js/globalize.min.js"></script>
        <script src="js/dx.chartjs.js"></script>

        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js"></script>

    </head>

    <style>
    html, body {
        margin: 0px;
        padding: 0px;
        font-family: 'Segoe UI', Helvetica, 'Droid Sans', Tahoma, Geneva, sans-serif;
        font-weight: 400;
        font-size: 12px;
        color: #FFFFFF;
    }

    body {
        background-color: #000000;
    }


    .dxg-range-container {
      width: 100px;
    }
    #tempGauge {
      float: left;
      position: absolute;
      width: 10%;
      height: 100%;
    }

    #speedGauge {
      z-index: 1;
      position: absolute;
      float:left;
      left:10%;
      width: 90%;
      height: 50%;
    }

    #speedDiv {
      z-index: 2;
      position: absolute;
      float:left;
      left:10%;
      top:80px;
      width: 90%;
      height: 200px;
    }

    #rpmGauge {
      z-index: 3;
      position: absolute;
      top: 120px;
      left:10%;
      float:left;
      width: 100%;
      height: 50%;
    }
    #rpmDiv {
      z-index: 4;
      position: absolute;
      float:left;
      top:220px;
      left:180px;
      width: 320px;
      height: 200px;
    }


    </style>

    <script type="text/javascript">

        var map;
        var marker;

        function initialize() {

            var myLatlng = new google.maps.LatLng(-34.397, 150.644)


            // Google Maps initialization
            var mapOptions = {
              center: myLatlng,
              zoom: 12
            };
            map = new google.maps.Map(document.getElementById("map-canvas"),
                mapOptions);

            marker = new google.maps.Marker({
                position: myLatlng,
                map: map,
                title:"Hello World!"
            });

        }

        function changeMarkerPosition(marker,lat,lng) {
            var latlng = new google.maps.LatLng(lat,lng);
            marker.setPosition(latlng);
            map.panTo(latlng);
        }

        google.maps.event.addDomListener(window, 'load', initialize);


    var client = new Messaging.Client('broker.mqttdashboard.com', 8000, 'myclientid2234');

    client.onMessageArrived = function (message) {
        console.log(message.destinationName + '  | ' + message.payloadString);

        var rpm = message.payloadString.split("|")[0];
        var speed = message.payloadString.split("|")[1];

        var lat = message.payloadString.split("|")[2];
        var lng = message.payloadString.split("|")[3];

        $('#RPMGauge').dxLinearGauge('instance').value(rpm/1000);
        $('#SpeedGauge').dxCircularGauge('instance').value(speed);

        $("#speedDiv").html(speed);
        $("#rpmDiv").html(rpm);

        //changeMarkerPosition(marker,lat, lng);
    };

    var mqttOptions = {
        timeout: 3,

        onSuccess: function () {
            console.log("Connected");
            client.subscribe('testGaugeTopic/#', {qos: 2});
        },

        onFailure: function (message) {
            alert("Connection failed: " + message.errorMessage);
        }

    };

	function init() {
		client.connect(mqttOptions);

       $(function ()  {

            $("#SpeedGauge").dxCircularGauge({
            geometry: {
                startAngle: 135,
                endAngle: 45
            },

            scale: {
                startValue: 0,
                endValue: 140,
                tickInterval: 10,
                label: {
                  font: {
                      size: 10,
                      color: "#FFFFFF"
                  }
                }
            },
            valueIndicator: {
                type: "rangebar",
                baseValue: 0,
                offset: 2
            },
            title: {
              text: "MPH",
              font: {
                  size: 20,
                  color: "#FFFFFF"
              }
            },
            value: 20
        });

      /*  $("#RPMGauge").dxCircularGauge({
        geometry: {
            startAngle: 100,
            endAngle: 90
        },
        rangeContainer: {
            offset: 0,
            ranges: [
                { startValue: 0, endValue: 5, color: "#77DD77" },
                { startValue: 5, endValue: 10, color: "#E6E200" },
                { startValue: 10, endValue: 14, color: "#92000A" }
            ]
        },
        scale: {
            startValue: 0,
            endValue: 14,
            tickInterval: 1,
            label: {
              font: {
                  size: 10,
                  color: "#FFFFFF"
              }
            }
        },
        valueIndicator: {
            type: "rangebar",
            baseValue: 0,
            offset: 2
        },
        title: {
          text: "RPM",
          font: {
              size: 20,
              color: "#FFFFFF"
          }
        },
        value: 20
    }); */

    $("#RPMGauge").dxLinearGauge({
   geometry: { orientation: "horozontal" },
   scale: {
       startValue: 0,
       endValue: 14,
       tickInterval: 1,
       size: 30,
       label: {
         font: {
             size: 10,
             color: "#FFFFFF"
         }
       }
   },
   rangeContainer: {
       offset: 0,
       ranges: [
           { startValue: 0, endValue: 5, color: "#77DD77" },
           { startValue: 5, endValue: 10, color: "#E6E200" },
           { startValue: 10, endValue: 14, color: "#92000A" }
       ]
   },
   title: {
     text: "RPM",
     font: {
         size: 20,
         color: "#FFFFFF"
     }
   },
   value: 35
});

        $("#gauge").dxLinearGauge({
       geometry: { orientation: "vertical" },
       scale: {
           startValue: 0,
           endValue: 120,
           tickInterval: 10,
           label: {
             font: {
                 size: 10,
                 color: "#FFFFFF"
             }
           }
       },
       title: {
         text: "Â°C",
         font: {
             size: 20,
             color: "#FFFFFF"
         }
       },
       value: 35
   });
        });

	}

    </script>

</head>
<body onload="init();">
  <div class="pane">

      <div id="tempGauge"></div>

      <!-- <div id="tempDiv"></div> <! style="position: absolute; float:left; left:30px; top:220px; width: 320px; height: 200px;">10</div> -->

      <div id="SpeedGauge"></div> <!-- style="z-index: 1; position: absolute; float:left; left:30px; width: 320px; height: 200px;"></div> -->

<!--      <div id="speedDiv"></div> style="z-index: 2; position: absolute; float:left; left:175px; top:80px; width: 320px; height: 200px;">0</div> -->

      <div id="RPMGauge"></div> <!-- class="case-container" style="z-index: 3; position: absolute; top: 120px; left:30px; float:left; width: 320px; height: 200px;"></div> -->

  <!--    <div id="rpmDiv" ></div>  style="z-index: 4; position: absolute; float:left; top:220px; left:180px; width: 320px; height: 200px;">0</div> -->

      <!-- <div id="map-canvas" class="case-container" style="left:320px; width: 400px; height: 400px;"/></div> -->
</div>




</body>

</html>
